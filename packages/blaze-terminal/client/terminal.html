<!-- packages/blaze-terminal/client/terminal.html -->
<template name="terminal">
  <!-- Connection Modal -->
  {{#if showConnectionModal}}
  <div class="connection-modal-overlay">
    <div class="connection-modal">
      <div class="modal-header">
        <h3> SSH Connection</h3>
        <button class="modal-close">×</button>
      </div>
      
      <div class="modal-body">
        <!-- NEW: Container Connection Section -->
        <div class="container-connection-section">
          <button type="button" class="btn btn-primary connect-containers-btn">
             Connect to Containers
          </button>
          <div class="section-divider">
            <span>OR</span>
          </div>
        </div>

        <!-- Saved Connections Section -->
        {{#if hasSavedConnections}}
        <div class="saved-connections-section">
          <div class="saved-connections-header">
            <h4> Saved Connections</h4>
            <button class="toggle-saved-connections btn-link">
              {{#if showSaveCredentials}}Hide{{else}}Show{{/if}}
            </button>
          </div>
          
          {{#if showSaveCredentials}}
          <div class="saved-connections-list">
            {{#each savedConnections}}
            <div class="saved-connection-item" data-connection-id="{{id}}">
              <div class="connection-info">
                <div class="connection-name">{{name}}</div>
                <div class="connection-details">{{username}}@{{host}}:{{port}}</div>
              </div>
              <button class="delete-saved-connection" data-connection-id="{{id}}" title="Delete">
                ×
              </button>
            </div>
            {{/each}}
          </div>
          <div class="saved-connections-divider"></div>
          {{/if}}
        </div>
        {{/if}}

        <!-- SSH Configuration Form -->
        <form class="connection-form">
          <div class="form-row">
            <div class="form-group">
              <label for="host">Host / IP Address</label>
              <input type="text" name="host" id="host" class="ssh-input" 
                      placeholder="localhost or IP address" required>
            </div>
            <div class="form-group form-group-small">
              <label for="port">Port</label>
              <input type="number" name="port" id="port" class="ssh-input" 
                      placeholder="22" min="1" max="65535" value="22">
            </div>
          </div>
          
          <div class="form-group">
            <label for="username">Username</label>
            <input type="text" name="username" id="username" class="ssh-input" 
                    placeholder="root, ubuntu, user..." required>
          </div>
          
          <div class="form-group">
            <label for="password">Password</label>
            <input type="password" name="password" id="password" class="ssh-input" 
                    placeholder="Enter password" required>
          </div>
          
          <div class="form-actions">
            <div class="form-actions-left">
              <button type="button" class="btn btn-secondary clear-form-btn">
                 Clear
              </button>
              <button type="button" class="btn btn-save save-connection-btn">
                 Save
              </button>
            </div>
            <div class="form-actions-right">
              <button type="button" class="btn btn-secondary modal-close">Cancel</button>
              <button type="submit" class="btn btn-primary">
                 Connect
              </button>
            </div>
          </div>
        </form>

        <!-- Container Mode Status (shows when in container mode) -->
        {{#if isContainerMode}}
        <div class="container-mode-status">
          <div class="status-message">
            <span class="status-icon"></span>
            <span class="status-text">Checking for your container...</span>
          </div>
          <button type="button" class="btn btn-secondary reset-mode-btn">
            ← Back to SSH Mode
          </button>
        </div>
        {{/if}}
      </div>
    </div>
  </div>
  {{/if}}

  <!-- Terminal Panel -->
  <div class="terminal-panel {{#if isTerminalVisible}}visible{{/if}}">
    <!-- Terminal Header -->
    <div class="terminal-header">
      <div class="terminal-tabs">
        {{#each terminals}}
          <div class="terminal-tab {{#if isActive}}active{{/if}} status-{{status}}" data-id="{{id}}">
            <span class="connection-indicator"></span>
            <span class="tab-title">{{title}}</span>
            <button class="close-tab" data-id="{{id}}">×</button>
          </div>
        {{/each}}
        <button class="add-terminal" title="New SSH Connection">
          <span class="add-icon">+</span>
        </button>
      </div>
      
      <div class="terminal-controls">
        <div class="connection-status status-{{connectionStatus}}">
          {{#if isConnected}}
            <span class="status-indicator">●</span> Connected
          {{else if isConnecting}}
            <span class="status-indicator">●</span> Connecting...
          {{else}}
            <span class="status-indicator">●</span> Disconnected
          {{/if}}
        </div>
        <button class="control-btn" id="minimize-terminal" title="Minimize">−</button>
        <button class="control-btn" id="maximize-terminal" title="Maximize">□</button>
        <button class="control-btn" id="close-terminal" title="Close">×</button>
      </div>
    </div>
    
    <!-- Terminal Content -->
    <div class="terminal-content">
      {{#if terminals.length}}
        {{#each terminals}}
          <div class="terminal-instance {{#unless isActive}}hidden{{/unless}}" data-id="{{id}}">
            {{#if isTerminalConnecting}}
              <div class="terminal-loading">
                <div class="loading-spinner"></div>
                <p>Connecting to {{title}}...</p>
              </div>
            {{/if}}
            <div class="xterm-container" id="terminal-{{id}}"></div>
          </div>
        {{/each}}
      {{else}}
        <div class="terminal-empty">
          <div class="empty-state">
            <div class="empty-icon"></div>
            <h3>No Terminal Sessions</h3>
            <p>Click the + button to create a new SSH connection</p>
            <button class="btn btn-primary add-terminal">
               Create SSH Connection
            </button>
          </div>
        </div>
      {{/if}}
    </div>
    
    <!-- Resize Handle -->
    <div class="resize-handle"></div>
  </div>
  
  <!-- Terminal Toggle (when hidden) -->
  {{#unless isTerminalVisible}}
    <button class="terminal-toggle">
       Terminal
      {{#if terminals.length}}
        <span class="terminal-badge">{{terminals.length}}</span>
      {{/if}}
    </button>
  {{/unless}}
</template>