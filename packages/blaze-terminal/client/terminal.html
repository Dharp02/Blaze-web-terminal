<!-- packages/blaze-terminal/client/terminal.html -->
<template name="terminal">
  <!-- Connection Modal -->
  {{#if showConnectionModal}}
  <div class="connection-modal-overlay">
    <div class="connection-modal">
      <div class="modal-header">
        <h3>üîå Connection Manager</h3>
        <button class="modal-close">√ó</button>
      </div>
      
      <div class="modal-body">
        <!-- Tab Navigation -->
        <div class="connection-tabs">
          <button class="connection-tab active" data-tab="containers">
             Containers
          </button>
          <button class="connection-tab" data-tab="ssh">
             SSH
          </button>
          {{#if hasSavedConnections}}
          <button class="connection-tab" data-tab="saved">
             Saved ({{savedConnections.length}})
          </button>
          {{/if}}
        </div>

        <!-- Tab Content Area -->
        <div class="tab-content">
          
          <!-- CONTAINERS TAB (Default Active) -->
          <div class="tab-pane containers-pane active">
            {{#if isContainerMode}}
              <div class="container-loading">
                <div class="loading-spinner"></div>
                <p>Checking for your container...</p>
                <button type="button" class="btn btn-secondary reset-mode-btn">
                  ‚Üê Back to SSH Mode
                </button>
              </div>
            {{else}}
              <div class="no-container-state">
                <div class="container-icon"></div>
                <h4>Personal Container</h4>
                <p>Create your own development container with pre-configured environment</p>
                <button class="btn btn-primary connect-containers-btn">
                   Connect to Containers
                </button>
              </div>
            {{/if}}
          </div>

          <!-- SSH TAB -->
          <div class="tab-pane ssh-pane">
            <form class="connection-form">
              <div class="form-row">
                <div class="form-group">
                  <label for="host">Host / IP Address</label>
                  <input type="text" name="host" id="host" class="ssh-input" 
                          placeholder="localhost or IP address" required>
                </div>
                <div class="form-group form-group-small">
                  <label for="port">Port</label>
                  <input type="number" name="port" id="port" class="ssh-input" 
                          placeholder="22" min="1" max="65535" value="22">
                </div>
              </div>
              
              <div class="form-group">
                <label for="username">Username</label>
                <input type="text" name="username" id="username" class="ssh-input" 
                        placeholder="root, ubuntu, user..." required>
              </div>
              
              <div class="form-group">
                <label for="password">Password</label>
                <input type="password" name="password" id="password" class="ssh-input" 
                        placeholder="Enter password" required>
              </div>
              
              <div class="form-actions">
                <div class="form-actions-left">
                  <button type="button" class="btn btn-secondary clear-form-btn">
                     Clear
                  </button>
                  <button type="button" class="btn btn-save save-connection-btn">
                     Save
                  </button>
                </div>
                <div class="form-actions-right">
                  <button type="button" class="btn btn-secondary modal-close">Cancel</button>
                  <button type="submit" class="btn btn-primary">
                     Connect
                  </button>
                </div>
              </div>
            </form>
          </div>

          <!-- SAVED CONNECTIONS TAB -->
          {{#if hasSavedConnections}}
          <div class="tab-pane saved-pane">
            <div class="saved-connections-header">
              <h4>Your Saved Connections</h4>
              <button class="toggle-saved-connections btn-link">
                {{#if showSaveCredentials}}Hide{{else}}Show All{{/if}}
              </button>
            </div>
            
            {{#if showSaveCredentials}}
            <div class="saved-connections-grid">
              {{#each savedConnections}}
              <div class="saved-connection-card" data-connection-id="{{id}}">
                <div class="connection-header">
                  <div class="connection-name">{{name}}</div>
                  <button class="delete-saved-connection" data-connection-id="{{id}}" title="Delete">
                    √ó
                  </button>
                </div>
                <div class="connection-details">
                  <div class="detail-item">
                    <span class="label">Host:</span>
                    <span class="value">{{host}}</span>
                  </div>
                  <div class="detail-item">
                    <span class="label">Port:</span>
                    <span class="value">{{port}}</span>
                  </div>
                  <div class="detail-item">
                    <span class="label">User:</span>
                    <span class="value">{{username}}</span>
                  </div>
                </div>
                <button class="btn btn-primary saved-connection-item" data-connection-id="{{id}}">
                   Connect
                </button>
              </div>
              {{/each}}
            </div>
            {{else}}
            <div class="saved-connections-preview">
              <p>{{savedConnections.length}} saved connections available</p>
            </div>
            {{/if}}
          </div>
          {{/if}}

        </div>
      </div>
    </div>
  </div>
  {{/if}}

  <!-- Terminal Panel -->
  <div class="terminal-panel {{#if isTerminalVisible}}visible{{/if}}">
    <!-- Terminal Header -->
    <div class="terminal-header">
      <div class="terminal-tabs">
        {{#each terminals}}
          <div class="terminal-tab {{#if isActive}}active{{/if}} status-{{status}}" data-id="{{id}}">
            <span class="connection-indicator"></span>
            <span class="tab-title">{{title}}</span>
            <button class="close-tab" data-id="{{id}}">√ó</button>
          </div>
        {{/each}}
        <button class="add-terminal" title="New Connection">
          <span class="add-icon">+</span>
        </button>
      </div>
      
      <div class="terminal-controls">
        <div class="connection-status status-{{connectionStatus}}">
          {{#if isConnected}}
            <span class="status-indicator">‚óè</span> Connected
          {{else if isConnecting}}
            <span class="status-indicator">‚óè</span> Connecting...
          {{else}}
            <span class="status-indicator">‚óè</span> Disconnected
          {{/if}}
        </div>
        <button class="control-btn" id="minimize-terminal" title="Minimize">‚àí</button>
        <button class="control-btn" id="maximize-terminal" title="Maximize">‚ñ°</button>
        <button class="control-btn" id="close-terminal" title="Close">√ó</button>
      </div>
    </div>
    
    <!-- Terminal Content -->
    <div class="terminal-content">
      {{#if terminals.length}}
        {{#each terminals}}
          <div class="terminal-instance {{#unless isActive}}hidden{{/unless}}" data-id="{{id}}">
            {{#if isTerminalConnecting}}
              <div class="terminal-loading">
                <div class="loading-spinner"></div>
                <p>Connecting to {{title}}...</p>
              </div>
            {{/if}}
            <div class="xterm-container" id="terminal-{{id}}"></div>
          </div>
        {{/each}}
      {{else}}
        <div class="terminal-empty">
          <div class="empty-state">
            <div class="empty-icon"></div>
            <h3>No Terminal Sessions</h3>
            <p>Click the + button to create a new connection</p>
            <button class="btn btn-primary add-terminal">
               New Connection
            </button>
          </div>
        </div>
      {{/if}}
    </div>
    
    <!-- Resize Handle -->
    <div class="resize-handle"></div>
  </div>
  
  <!-- Terminal Toggle (when hidden) -->
  {{#unless isTerminalVisible}}
    <button class="terminal-toggle">
       Terminal
      {{#if terminals.length}}
        <span class="terminal-badge">{{terminals.length}}</span>
      {{/if}}
    </button>
  {{/unless}}
</template>